fetch('game.json')
  .then(res => res.json())
  .then(initGame);

let gameData, currentStage = 0, playerName;

function initGame(data) {
  gameData = data;
}

function startGame() {
  playerName = document.getElementById("player-name").value || "Ø§Ù„Ù„Ø§Ø¹Ø¨";
  currentStage = 0;
  loadStage(currentStage);
}

function loadStage(i) {
  const stage = gameData.levels.version1.stages[i];
  if (!stage) {
    document.getElementById("game-container").innerHTML = `<h2>ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ ${playerName}! Ø£ÙƒÙ…Ù„Øª ÙƒÙ„ Ø§Ù„Ù…Ø±Ø§Ø­Ù„.</h2>`;
    return;
  }

  document.getElementById("level-info").innerText = stage.name;
  document.getElementById("ai-dialogue").innerText = `AI: ${gameData.ai.persona[Math.min(i, gameData.ai.persona.length-1)].dialogue}`;

  const qDiv = document.getElementById("questions-container");
  qDiv.innerHTML = "";
  stage.puzzles.forEach(q => {
    const btn = document.createElement("button");
    btn.innerText = q.question;
    btn.onclick = () => checkAnswer(q);
    qDiv.appendChild(btn);
  });
}

function checkAnswer(q) {
  const ans = prompt(`${q.question}\n${q.options.join(" | ")}`);
  if (ans === q.answer) {
    alert("Ù…Ù…ØªØ§Ø²! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ðŸŽ‰");
    currentStage++;
    loadStage(currentStage);
  } else {
    alert(`Ø®Ø·Ø£! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${q.answer}`);
  }
}
